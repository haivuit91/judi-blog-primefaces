<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui">

    <body>

        <ui:composition template="./common.xhtml">

            <ui:define name="content">
                <f:view>
                    <h:form id="formListUsers">
                        <p:commandButton style="float: left" value="Add user" update=":addUser" oncomplete="PF('addDialog').show()"
                                         icon="ui-icon-circle-plus" title="Create" />
                        <p:growl id="msgs" showDetail="true" />
                        <h:panelGroup id="result2">
                            <p:dataTable var="listUser" value="#{userManager.allUser}" paginator="true" rows="20"
                                         paginatorTemplate="{FirstPageLink} {PageLinks} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="10,20,30,50"
                                         widgetVar="userFilter" emptyMessage="No found users" filteredValue="#{userManager.searchUser}">
                                <f:facet name="header">
                                    <p:outputPanel>
                                        <h:outputText value="Search:" />
                                        <p:inputText id="globalFilter" onkeyup="PF('userFilter').filter()" style="width:150px" placeholder="Enter keyword"/>
                                    </p:outputPanel>
                                </f:facet>

                                <p:column width="25">  
                                    <f:facet name="header">ID</f:facet>  
                                    <h:outputText value="#{listUser.userID}" />  
                                </p:column>

                                <p:column sortBy="#{listUser.userName}" filterBy="#{listUser.userName}" width="110">  
                                    <f:facet name="header">Username</f:facet>  
                                    <h:outputText value="#{listUser.userName}" />  
                                </p:column>

                                <p:column sortBy="#{listUser.fullName}" filterBy="#{listUser.fullName}" width="150">  
                                    <f:facet name="header">Full name</f:facet>  
                                    <h:outputText value="#{listUser.fullName}" />  
                                </p:column>

                                <p:column sortBy="#{listUser.birthday}" filterBy="#{listUser.birthday}" width="110">  
                                    <f:facet name="header">Birthday</f:facet>  
                                    <h:outputText value="#{listUser.birthday}" >
                                        <f:convertDateTime dateStyle="default" pattern="dd/MM/yyyy" timeZone="vi_VN" type="date"/> 
                                    </h:outputText>  
                                </p:column>

                                <p:column filterBy="#{listUser.gender}" headerText="Gender" width="110">
                                    <f:facet name="filter">
                                        <p:selectOneMenu onchange="PF('userFilter').filter()" >
                                            <f:selectItem itemLabel="Select One" itemValue="#{null}" noSelectionOption="true" />
                                            <f:selectItem itemLabel="Male" itemValue="0"/>
                                            <f:selectItem itemLabel="Female" itemValue="1"/>
                                        </p:selectOneMenu>
                                    </f:facet>
                                    <h:outputText value="#{listUser.gender > 0 ? 'Female': 'Male'}" />
                                </p:column>

                                <p:column sortBy="#{listUser.email}" filterBy="#{listUser.email}">  
                                    <f:facet name="header">Email</f:facet>  
                                    <h:outputText value="#{listUser.email}" />  
                                </p:column>

                                <p:column sortBy="#{listUser.phone}" filterBy="#{listUser.phone}" width="120">  
                                    <f:facet name="header">Phone</f:facet>  
                                    <h:outputText value="#{listUser.phone}" />  
                                </p:column>

                                <p:column filterBy="#{listUser.role.roleName}" headerText="Role" width="95">
                                    <f:facet name="filter">
                                        <p:selectCheckboxMenu label="All roles" onchange="PF('userFilter').filter()" panelStyle="width:125px" scrollHeight="100">
                                            <f:selectItems var="role" value="#{userManager.roles}" itemLabel="#{role.roleName}" itemValue="#{role.roleName}"/>
                                        </p:selectCheckboxMenu>
                                    </f:facet>
                                    <h:outputText value="#{listUser.role.roleName}" />
                                </p:column>

                                <p:column width="40">  
                                    <f:facet name="header">Status</f:facet>
                                    <p:commandButton type="button" title="Inactive" icon="ui-icon-locked" rendered="#{listUser.active == 0 ? 'true':'false'}"/>
                                    <p:commandButton type="button" title="Active" icon="ui-icon-unlocked" rendered="#{listUser.active == 1 ? 'true':'false'}"/>
                                </p:column>

                                <p:column width="71">
                                    <p:splitButton update=":userViews" oncomplete="PF('viewDialog').show()" icon="ui-icon-search">
                                        <f:setPropertyActionListener value="#{listUser}" target="#{userManager.user}" />
                                        <p:menuitem update=":editUser" oncomplete="PF('editDialog').show()" value="Edit" icon="ui-icon-pencil" >
                                            <f:setPropertyActionListener value="#{listUser}" target="#{userManager.user}" />
                                        </p:menuitem>
                                        <p:menuitem update=":userDelete" oncomplete="PF('deleteDialog').show()" value="Delete" icon="ui-icon-trash" >
                                            <f:setPropertyActionListener value="#{listUser}" target="#{userManager.user}" />
                                        </p:menuitem>
                                        <p:menuitem update=":userBan" oncomplete="PF('banDialog').show()" value="Ban" icon="ui-icon-cancel" 
                                                    rendered="#{listUser.active == 1 ? 'true':'false'}">
                                            <f:setPropertyActionListener value="#{listUser}" target="#{userManager.user}" />
                                        </p:menuitem>
                                        <p:menuitem update=":userRestore" oncomplete="PF('restoreDialog').show()" value="Restore" icon="ui-icon-arrowreturnthick-1-w" 
                                                    rendered="#{listUser.active == 0 ? 'true':'false'}">
                                            <f:setPropertyActionListener value="#{listUser}" target="#{userManager.user}" />
                                        </p:menuitem>
                                        <p:separator rendered="#{listUser.role.roleID != 1 and listUser.active == 1 ? 'true':'false'}" />
                                        <p:menuitem update=":makeAdmin" oncomplete="PF('makeadminDialog').show()" value="Make admin"
                                                    rendered="#{listUser.role.roleID != 1 and listUser.active == 1 ? 'true':'false'}" >
                                            <f:setPropertyActionListener value="#{listUser}" target="#{userManager.user}" />
                                        </p:menuitem>
                                    </p:splitButton>
                                </p:column>
                            </p:dataTable>
                        </h:panelGroup>
                    </h:form>
                </f:view>  
            </ui:define>

        </ui:composition>

    </body>
</html>
